<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alumed Pro | Microsc√≥pio AI Inteligente</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/openseadragon/4.1.0/openseadragon.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        * { font-family: 'Inter', sans-serif; }
        body { overflow: hidden; }
        .openseadragon-canvas:focus { outline: none; }
        
        /* Canvas de desenho */
        #drawing-canvas {
            position: absolute;
            top: 0;
            left: 0;
            cursor: crosshair;
            z-index: 5;
        }
        
        /* Anima√ß√µes suaves */
        .tool-btn {
            transition: all 0.2s ease;
        }
        
        .tool-btn.active {
            background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%);
            box-shadow: 0 0 12px rgba(20, 184, 166, 0.5);
            transform: scale(1.05);
        }
        
        .tool-btn:hover:not(.active) {
            background: rgba(20, 184, 166, 0.2);
            transform: translateY(-2px);
        }
        
        /* Color picker style */
        .color-swatch {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .color-swatch.active {
            border-color: #14b8a6;
            box-shadow: 0 0 8px rgba(20, 184, 166, 0.6);
        }
        
        /* Sidebar com gradiente */
        .sidebar {
            background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
        }
        
        /* Badge animado */
        .badge-zoom {
            animation: pulse 0.5s ease-in-out;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        /* Tooltip */
        .tooltip {
            position: relative;
        }
        
        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: #1e293b;
            color: #14b8a6;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 11px;
            white-space: nowrap;
            border: 1px solid #14b8a6;
            z-index: 20;
        }
        
        /* Loading spinner */
        .spinner {
            border: 2px solid rgba(20, 184, 166, 0.2);
            border-top: 2px solid #14b8a6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="h-screen w-screen overflow-hidden bg-slate-950 text-white flex">

    <!-- SIDEBAR ESQUERDA -->
    <aside class="sidebar w-96 border-r border-slate-700 flex flex-col z-10 shadow-2xl">
        
        <!-- Header -->
        <div class="p-6 border-b border-slate-700 bg-gradient-to-r from-slate-900 to-slate-800">
            <div class="flex items-center gap-3 mb-2">
                <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-teal-400 to-cyan-500 flex items-center justify-center">
                    <i class="fas fa-microscope text-white"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-teal-400 to-cyan-300">
                        Alumed Pro
                    </h1>
                    <p class="text-xs text-slate-400">v2.0 ‚Ä¢ Microscopia Inteligente</p>
                </div>
            </div>
        </div>

        <!-- Conte√∫do da Sidebar -->
        <div class="flex-1 overflow-y-auto p-5 space-y-6">
            
            <!-- L√¢mina Atual -->
            <div class="bg-slate-800/50 backdrop-blur rounded-xl p-4 border border-slate-700 hover:border-teal-500/50 transition">
                <h2 class="text-xs uppercase tracking-widest text-teal-400 font-bold mb-3">üìÑ L√¢mina Carregada</h2>
                <h3 class="font-semibold text-white text-sm">Cardioesophageal Junction</h3>
                <p class="text-xs text-slate-300 mt-2">Colora√ß√£o: HE ‚Ä¢ Magnifica√ß√£o: 10x</p>
                <div class="mt-3 h-1 bg-gradient-to-r from-teal-500 to-cyan-500 rounded-full"></div>
            </div>

            <!-- Ferramentas de Desenho -->
            <div>
                <h2 class="text-xs uppercase tracking-widest text-teal-400 font-bold mb-3">üé® Ferramentas</h2>
                <div class="grid grid-cols-3 gap-2 mb-3">
                    <button onclick="setTool('pen')" class="tool-btn active p-3 rounded-lg bg-teal-600/30 border border-teal-500/50 hover:bg-teal-600/50 tooltip" data-tooltip="Caneta (P)">
                        <i class="fas fa-pen text-teal-400"></i>
                    </button>
                    <button onclick="setTool('eraser')" class="tool-btn p-3 rounded-lg bg-slate-700 border border-slate-600 hover:border-teal-500/30 tooltip" data-tooltip="Borracha (E)">
                        <i class="fas fa-eraser text-slate-300"></i>
                    </button>
                    <button onclick="setTool('circle')" class="tool-btn p-3 rounded-lg bg-slate-700 border border-slate-600 hover:border-teal-500/30 tooltip" data-tooltip="C√≠rculo (C)">
                        <i class="fas fa-circle text-slate-300"></i>
                    </button>
                    <button onclick="setTool('rectangle')" class="tool-btn p-3 rounded-lg bg-slate-700 border border-slate-600 hover:border-teal-500/30 tooltip" data-tooltip="Ret√¢ngulo (R)">
                        <i class="fas fa-square text-slate-300"></i>
                    </button>
                    <button onclick="setTool('arrow')" class="tool-btn p-3 rounded-lg bg-slate-700 border border-slate-600 hover:border-teal-500/30 tooltip" data-tooltip="Seta (A)">
                        <i class="fas fa-arrow-right text-slate-300"></i>
                    </button>
                    <button onclick="clearDrawing()" class="tool-btn p-3 rounded-lg bg-red-500/20 border border-red-500/30 hover:bg-red-500/30 tooltip" data-tooltip="Limpar (C+L)">
                        <i class="fas fa-trash text-red-400"></i>
                    </button>
                </div>
            </div>

            <!-- Cores -->
            <div>
                <h2 class="text-xs uppercase tracking-widest text-teal-400 font-bold mb-3">üåà Cores</h2>
                <div class="grid grid-cols-6 gap-2">
                    <div class="color-swatch active" style="background: #14b8a6" onclick="setColor('#14b8a6')" title="Teal"></div>
                    <div class="color-swatch" style="background: #ef4444" onclick="setColor('#ef4444')" title="Red"></div>
                    <div class="color-swatch" style="background: #3b82f6" onclick="setColor('#3b82f6')" title="Blue"></div>
                    <div class="color-swatch" style="background: #fbbf24" onclick="setColor('#fbbf24')" title="Yellow"></div>
                    <div class="color-swatch" style="background: #10b981" onclick="setColor('#10b981')" title="Green"></div>
                    <div class="color-swatch" style="background: #ffffff" onclick="setColor('#ffffff')" title="White"></div>
                </div>
            </div>

            <!-- Espessura -->
            <div>
                <h2 class="text-xs uppercase tracking-widest text-teal-400 font-bold mb-3">‚úèÔ∏è Espessura</h2>
                <input type="range" id="brush-size" min="1" max="20" value="3" 
                    class="w-full cursor-pointer accent-teal-500">
                <div class="flex justify-between mt-2">
                    <span class="text-xs text-slate-400">Fina</span>
                    <span class="text-sm font-semibold text-teal-400" id="size-display">3px</span>
                    <span class="text-xs text-slate-400">Grossa</span>
                </div>
            </div>

            <!-- Estruturas Identificadas -->
            <div>
                <h2 class="text-xs uppercase tracking-widest text-teal-400 font-bold mb-3">üî¨ Estruturas Mapeadas</h2>
                <div class="space-y-2">
                    <button onclick="focusStructure(0.5, 0.5, 5)" 
                        class="w-full text-left p-3 rounded-lg bg-slate-700/50 hover:bg-teal-600/30 transition-all border border-slate-600 group">
                        <div class="flex justify-between items-center">
                            <span class="font-medium text-sm">Vilosidades Intestinais</span>
                            <span class="text-xs bg-slate-900 px-2 py-1 rounded text-teal-400 group-hover:text-teal-300">4x</span>
                        </div>
                    </button>
                    <button onclick="focusStructure(0.2, 0.4, 20)" 
                        class="w-full text-left p-3 rounded-lg bg-slate-700/50 hover:bg-teal-600/30 transition-all border border-slate-600 group">
                        <div class="flex justify-between items-center">
                            <span class="font-medium text-sm">Criptas de Lieberk√ºhn</span>
                            <span class="text-xs bg-slate-900 px-2 py-1 rounded text-teal-400 group-hover:text-teal-300">20x</span>
                        </div>
                    </button>
                    <button class="w-full mt-3 p-3 rounded-lg border border-teal-500 text-teal-400 flex items-center justify-center gap-2 hover:bg-teal-500/20 transition font-semibold text-sm">
                        <i class="fas fa-bolt"></i>
                        Analisar com IA (Profe Joy)
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="p-4 border-t border-slate-700 bg-gradient-to-r from-slate-900/50 to-slate-800/50 text-xs text-center text-slate-500">
            ‚ö° Desenvolvido por <span class="text-teal-400 font-semibold">Matheus L.</span>
        </div>
    </aside>

    <!-- MAIN VIEWER -->
    <main class="flex-1 relative bg-black">
        
        <!-- OpenSeadragon Viewer -->
        <div id="openseadragon-viewer" class="w-full h-full"></div>
        
        <!-- Canvas de Desenho (overlay) -->
        <canvas id="drawing-canvas"></canvas>

        <!-- Controles Principais (estilo Google Maps) -->
        <div class="absolute top-6 right-6 flex flex-col gap-3 bg-slate-900/90 backdrop-blur p-3 rounded-xl border border-slate-700 shadow-2xl">
            <!-- Zoom In -->
            <button id="zoom-in" class="p-3 hover:bg-teal-600 rounded-lg text-white transition-all tooltip" data-tooltip="Zoom In (+)">
                <i class="fas fa-plus text-lg"></i>
            </button>
            
            <!-- Zoom Display -->
            <div class="px-3 py-2 text-center text-xs font-bold text-teal-400 bg-slate-800/50 rounded border border-slate-700">
                <span id="zoom-level">100%</span>
            </div>
            
            <!-- Zoom Out -->
            <button id="zoom-out" class="p-3 hover:bg-teal-600 rounded-lg text-white transition-all tooltip" data-tooltip="Zoom Out (-)">
                <i class="fas fa-minus text-lg"></i>
            </button>
            
            <!-- Separador -->
            <div class="h-px bg-slate-700"></div>
            
            <!-- Home/Reset -->
            <button id="home" class="p-3 hover:bg-teal-600 rounded-lg text-white transition-all tooltip" data-tooltip="Resetar (H)">
                <i class="fas fa-home text-lg"></i>
            </button>
            
            <!-- Fullscreen -->
            <button onclick="toggleFullscreen()" class="p-3 hover:bg-teal-600 rounded-lg text-white transition-all tooltip" data-tooltip="Fullscreen (F)">
                <i class="fas fa-expand text-lg"></i>
            </button>
        </div>

        <!-- Coordenadas e Info -->
        <div class="absolute bottom-6 left-6 bg-slate-900/90 backdrop-blur px-4 py-3 rounded-xl border border-slate-700 text-xs font-mono text-slate-300 shadow-2xl">
            <div>X: <span id="coord-x">0</span> | Y: <span id="coord-y">0</span></div>
            <div class="mt-1 text-teal-400">Zoom: <span id="zoom-display">1.0x</span></div>
        </div>

        <!-- Mini Mapa -->
        <div class="absolute bottom-6 right-6 bg-slate-900/95 backdrop-blur rounded-xl border border-slate-700 overflow-hidden shadow-2xl" style="width: 180px; height: 180px;">
            <div id="minimap-canvas" style="width: 100%; height: 100%; background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);" class="relative">
                <div class="absolute inset-0 flex items-center justify-center text-slate-500 text-xs">
                    <i class="fas fa-map"></i>&nbsp;Mini Map
                </div>
            </div>
        </div>
    </main>

    <script type="text/javascript">
        // ============= VARI√ÅVEIS GLOBAIS =============
        let currentTool = 'pen';
        let currentColor = '#14b8a6';
        let brushSize = 3;
        let isDrawing = false;
        let startX, startY;

        // ============= INICIALIZA√á√ÉO DO OPENSEADRAGON =============
        const viewer = OpenSeadragon({
            id: "openseadragon-viewer",
            prefixUrl: "https://cdnjs.cloudflare.com/ajax/libs/openseadragon/4.1.0/images/",
            tileSources: {
                type: 'image',
                url: 'imagens_laminas/lamina_0.jpg',
                buildPyramid: false
            },
            animationTime: 0.5,
            blendTime: 0.1,
            constrainDuringPan: true,
            visibilityRatio: 1.0,
            minZoomLevel: 0.5,
            maxZoomLevel: 20,
            defaultZoomLevel: 1,
            zoomInButton: "zoom-in",
            zoomOutButton: "zoom-out",
            homeButton: "home",
        });

        // ============= SETUP DO CANVAS DE DESENHO =============
        const canvas = document.getElementById('drawing-canvas');
        const ctx = canvas.getContext('2d');
        
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // ============= FUN√á√ïES DE DESENHO =============
        canvas.addEventListener('mousedown', (e) => {
            isDrawing = true;
            startX = e.clientX;
            startY = e.clientY;
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!isDrawing) return;
            
            const x = e.clientX;
            const y = e.clientY;
            
            ctx.strokeStyle = currentColor;
            ctx.lineWidth = brushSize;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';

            if (currentTool === 'pen') {
                ctx.globalCompositeOperation = 'source-over';
                ctx.beginPath();
                ctx.moveTo(startX, startY);
                ctx.lineTo(x, y);
                ctx.stroke();
            } else if (currentTool === 'eraser') {
                ctx.globalCompositeOperation = 'destination-out';
                ctx.clearRect(x - brushSize, y - brushSize, brushSize * 2, brushSize * 2);
            }

            startX = x;
            startY = y;

            // Atualizar coordenadas
            document.getElementById('coord-x').textContent = Math.round(x);
            document.getElementById('coord-y').textContent = Math.round(y);
        });

        canvas.addEventListener('mouseup', () => {
            isDrawing = false;
        });

        // ============= FERRAMENTAS =============
        function setTool(tool) {
            currentTool = tool;
            document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.tool-btn').classList.add('active');
            canvas.style.cursor = tool === 'eraser' ? 'grab' : 'crosshair';
        }

        function setColor(color) {
            currentColor = color;
            document.querySelectorAll('.color-swatch').forEach(swatch => swatch.classList.remove('active'));
            event.target.classList.add('active');
        }

        function clearDrawing() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // ============= SLIDER DE ESPESSURA =============
        document.getElementById('brush-size').addEventListener('input', (e) => {
            brushSize = e.target.value;
            document.getElementById('size-display').textContent = brushSize + 'px';
        });

        // ============= NAVEGA√á√ÉO =============
        function focusStructure(x, y, zoom) {
            const point = new OpenSeadragon.Point(x, y);
            viewer.viewport.panTo(point);
            viewer.viewport.zoomTo(zoom);
        }

        // ============= ATUALIZAR ZOOM DISPLAY =============
        viewer.addHandler('zoom', () => {
            const zoom = viewer.viewport.getZoom();
            document.getElementById('zoom-level').textContent = Math.round(zoom * 100) + '%';
            document.getElementById('zoom-display').textContent = zoom.toFixed(1) + 'x';
        });

        // ============= FULLSCREEN =============
        function toggleFullscreen() {
            const elem = document.querySelector('main');
            if (elem.requestFullscreen) {
                elem.requestFullscreen();
            } else if (elem.mozRequestFullScreen) {
                elem.mozRequestFullScreen();
            } else if (elem.webkitRequestFullscreen) {
                elem.webkitRequestFullscreen();
            }
        }

        // ============= ATALHOS DE TECLADO =============
        document.addEventListener('keydown', (e) => {
            if (e.key === 'p' || e.key === 'P') setTool('pen');
            if (e.key === 'e' || e.key === 'E') setTool('eraser');
            if (e.key === 'c' || e.key === 'C') setTool('circle');
            if (e.key === 'r' || e.key === 'R') setTool('rectangle');
            if (e.key === 'a' || e.key === 'A') setTool('arrow');
            if (e.key === 'h' || e.key === 'H') viewer.viewport.goHome();
            if (e.key === 'f' || e.key === 'F') toggleFullscreen();
            if (e.key === '+' || e.key === '=') viewer.viewport.zoomBy(1.2);
            if (e.key === '-') viewer.viewport.zoomBy(0.8);
        });

        // ============= INICIALIZA√á√ÉO =============
        console.log('üöÄ Alumed Pro v2.0 iniciado!');
        console.log('üìù Atalhos: P=Caneta, E=Borracha, C=C√≠rculo, R=Ret√¢ngulo, A=Seta, H=Home, F=Fullscreen');

    </script>
</body>
</html>